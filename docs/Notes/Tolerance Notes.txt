   41  2021-12-01 11:33:38 kubectl taint nodes eagnmnmkd05b node-role.kubernetes.io/etcd=true:NoSchedule
   42  2021-12-01 11:33:56 kubectl get nodes -o custom-columns=NAME:.metadata.name,TAINTS:.spec.taints


cattle-logging-system      rancher-logging-fluentbit-mkcd2                          1/1     Running            2          71d   10.42.0.36    eagnmnmkd01d   <none>           <none>
cattle-logging-system      rancher-logging-rke2-journald-aggregator-tpkz8           1/1     Running            2          71d   10.42.0.37    eagnmnmkd01d   <none>           <none>
cattle-monitoring-system   rancher-monitoring-prometheus-node-exporter-hnfk6        1/1     Running            1          37d   56.76.4.39    eagnmnmkd01d   <none>           <none>
cattle-system              cattle-cluster-agent-8cbf546bc-kpxfr                     1/1     Running            0          34s   10.42.0.44    eagnmnmkd01d   <none>           <none>
kube-system                cloud-controller-manager-eagnmnmkd01d                    1/1     Running            7          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                etcd-eagnmnmkd01d                                        1/1     Running            3          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-apiserver-eagnmnmkd01d                              1/1     Running            1          61d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-controller-manager-eagnmnmkd01d                     1/1     Running            7          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-proxy-eagnmnmkd01d                                  1/1     Running            3          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-scheduler-eagnmnmkd01d                              1/1     Running            5          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-vip-ds-nwh9q                                        1/1     Running            12         80d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                rke2-canal-2p6nd                                         2/2     Running            8          82d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                rke2-coredns-rke2-coredns-7bb4f446c-4cp4t                1/1     Running            4          82d   10.42.0.33    eagnmnmkd01d   <none>           <none>
kube-system                rke2-coredns-rke2-coredns-7bb4f446c-dldwr                1/1     Running            4          82d   10.42.0.35    eagnmnmkd01d   <none>           <none>
kube-system                rke2-ingress-nginx-controller-44hbv                      1/1     Running            1          58d   10.42.0.34    eagnmnmkd01d   <none>           <none>
kube-system                rke2-metrics-server-5df7d77b5b-zz69x                     1/1     Running            6          82d   10.42.0.32    eagnmnmkd01d   <none>           <none>
longhorn-system            csi-snapshotter-7f647c8b97-9lz2v                         1/1     Running            0          14m   10.42.0.40    eagnmnmkd01d   <none>           <none>
longhorn-system            engine-image-ei-0422ab0c-9krd7                           1/1     Running            0          14m   10.42.0.39    eagnmnmkd01d   <none>           <none>
longhorn-system            instance-manager-e-fcb05318                              1/1     Running            0          14m   10.42.0.42    eagnmnmkd01d   <none>           <none>
longhorn-system            instance-manager-r-c0db661f                              1/1     Running            0          14m   10.42.0.43    eagnmnmkd01d   <none>           <none>
longhorn-system            longhorn-csi-plugin-vv5p2                                2/2     Running            0          14m   10.42.0.41    eagnmnmkd01d   <none>           <none>
longhorn-system            longhorn-manager-5qfzs                                   1/1     Running            1          14m   10.42.0.38    eagnmnmkd01d   <none>           <none>

cattle-logging-system      rancher-logging-fluentbit-mkcd2                          1/1     Running            5          71d   10.42.0.94    eagnmnmkd01d   <none>           <none>
cattle-monitoring-system   rancher-monitoring-prometheus-node-exporter-hnfk6        1/1     Running            3          37d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                cloud-controller-manager-eagnmnmkd01d                    1/1     Running            9          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                etcd-eagnmnmkd01d                                        1/1     Running            5          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                helm-install-rke2-canal-8xq6m                            0/1     Completed          0          83d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                helm-install-rke2-coredns-5w6ms                          0/1     Completed          0          83d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-apiserver-eagnmnmkd01d                              1/1     Running            3          62d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-controller-manager-eagnmnmkd01d                     1/1     Running            9          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-proxy-eagnmnmkd01d                                  1/1     Running            5          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                kube-scheduler-eagnmnmkd01d                              1/1     Running            7          79d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                rke2-canal-2p6nd                                         2/2     Running            12         83d   56.76.4.39    eagnmnmkd01d   <none>           <none>
kube-system                rke2-coredns-rke2-coredns-7bb4f446c-4cp4t                1/1     Running            14         83d   10.42.0.95    eagnmnmkd01d   <none>           <none>
kube-system                rke2-coredns-rke2-coredns-7bb4f446c-dldwr                1/1     Running            9          83d   10.42.0.96    eagnmnmkd01d   <none>           <none>


Delete tolerations for rancher-logging-fluentbit
Add tolerations for 
Add tolerations to 
	rancher-logging-fluentbit						logging_tolerations.yaml
	rancher-logging-rke2-journald-aggregator		logging_tolerations.yaml
	rke2-ingress-nginx-controller					default_tolerations.yaml
	engine-image-ei									default_tolerations.yaml
	longhorn-csi-plugin								default_tolerations.yaml
	longhorn-manager								default_tolerations.yaml
	kube-vip-ds										default_tolerations.yaml
	
::::::::::::::
/root/default_tolerations.yaml
::::::::::::::
spec:
  template:
    spec:
      tolerations:
      - effect: NoSchedule
        operator: Exists
      - effect: NoExecute
        operator: Exists
		

::::::::::::::
/root/logging_tolerations.yaml
::::::::::::::
spec:
  template:
    spec:
      tolerations:
      - effect: NoSchedule
        key: cattle.io/os
        operator: Equal
        value: linux
      - effect: NoSchedule
        operator: Exists
      - effect: NoExecute
        operator: Exists



kubectl patch ds {{ item }} -n cattle-logging-system --patch "$(cat /root/logging_tolerations.yaml)"
kubectl patch ds {{ item }} -n kube-system --patch "$(cat /root/default_tolerations.yaml)"
kubectl patch ds {{ item }} -n longhorn-system --patch "$(cat /root/default_tolerations.yaml)"



kubectl taint nodes {{ item }} node-role.kubernetes.io/control-plane=true:NoSchedule
kubectl taint nodes {{ item }} node-role.kubernetes.io/etcd=true:NoExecute

	
	

